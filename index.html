<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Garena Guest Extractor + Level Checker</title>
  <style>
    body{font-family: Inter, system-ui; background:#0f1724; color:#e6eef8; margin:0; min-height:100vh; display:flex; justify-content:center; align-items:center;}
    .card{width:850px; max-width:95%; background:#0b1220; padding:28px; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,.7);}
    h1{margin:0 0 8px; font-size:24px;}
    p{color:#9fb0d0; font-size:14px;}
    .tabs{margin:20px 0; display:flex; gap:10px;}
    .tab{padding:10px 20px; background:#1f2a44; border-radius:8px; cursor:pointer;}
    .tab.active{background:#0ea5a3; color:#042022;}
    .tab-content{display:none;}
    .tab-content.active{display:block;}
    .row{display:flex; gap:12px; margin-top:15px; flex-wrap:wrap; align-items:center;}
    input, select, button{padding:10px 14px; border:none; border-radius:8px;}
    input, select{background:#1f2a44; color:#cfe9ff;}
    button{background:#0ea5a3; color:#042022; cursor:pointer;}
    pre{background:#071029; padding:16px; border-radius:8px; margin-top:20px; max-height:400px; overflow:auto; font-size:13px; color:#9fb0d0;}
    label[for=fileInput]{background:#1f2a44; padding:10px 14px; border-radius:8px; cursor:pointer;}
    input[type=file]{display:none;}
  </style>
</head>
<body>
<div class="card">
  <h1>Garena Guest Extractor + Level Checker</h1>
  <p>Extract UID/Password from guest_account_info + check levels in bulk</p>

  <div class="tabs">
    <div class="tab active" data-tab="extract">Extract Only</div>
    <div class="tab" data-tab="check">Check Levels</div>
  </div>

  <!-- Extract Tab -->
  <div id="extract" class="tab-content active">
    <div class="row">
      <label for="fileInput1">üìÅ Select File</label>
      <input id="fileInput1" type="file" accept=".txt,.json">
      <button id="extractBtn">Extract UID/Pass</button>
    </div>
    <pre id="output1">Waiting for file...</pre>
  </div>

  <!-- Level Check Tab -->
  <div id="check" class="tab-content">
    <div class="row">
      <label for="fileInput2">üìÅ Select File</label>
      <input id="fileInput2" type="file" accept=".txt,.json">

      <select id="region">
        <option value="IND">India (IND)</option>
        <option value="BD">Bangladesh (BD)</option>
        <option value="PK">Pakistan (PK)</option>
        <option value="OTHER">Other</option>
        <option value="BR">Brazil (BR)</option>
        <option value="ID">Indonesia (ID)</option>
        <option value="TH">Thailand (TH)</option>
        <option value="VN">Vietnam (VN)</option>
        <option value="MY">Malaysia (MY)</option>
      </select>

      <input type="number" id="minLevel" placeholder="Min Level (e.g. 50)" value="50" min="1" max="100">

      <button id="checkBtn">Check & Filter</button>
    </div>
    <pre id="output2">Results will appear here after checking...</pre>
  </div>
</div>

<script>
// Switch tabs
document.querySelectorAll('.tab').forEach(t => {
  t.onclick = () => {
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    document.getElementById(t.dataset.tab).classList.add('active');
  };
});

// === EXTRACT TAB ===
const extractBtn = document.getElementById('extractBtn');
const fileInput1 = document.getElementById('fileInput1');
const output1 = document.getElementById('output1');

extractBtn.onclick = async () => {
  const file = fileInput1.files[0];
  if (!file) return alert("Select a file first!");
  const text = await file.text();
  const lines = text.split("\n").filter(l => l.trim());
  let result = [];

  for (const line of lines) {
    try {
      const jsonStr = line.includes("{") ? line.substring(line.indexOf("{")) : line;
      const json = JSON.parse(jsonStr);
      const info = json.guest_account_info;
      if (info) {
        const uid = info["com.garena.msdk.guest_uid"];
        const password = info["com.garena.msdk.guest_password"];
        if (uid && password) result.push({ uid, password });
      }
    } catch (e) {}
  }
  output1.textContent = JSON.stringify(result, null, 2) || "No guest accounts found.";
};

// === LEVEL CHECK TAB ===
const checkBtn = document.getElementById('checkBtn');
const fileInput2 = document.getElementById('fileInput2');
const regionSelect = document.getElementById('region');
const minLevelInput = document.getElementById('minLevel');
const output2 = document.getElementById('output2');

checkBtn.onclick = async () => {
  const file = fileInput2.files[0];
  if (!file) return alert("Select a file first!");
  
  const region = regionSelect.value;
  const minLevel = parseInt(minLevelInput.value) || 1;
  
  output2.textContent = "Extracting UIDs...\n";
  
  const text = await file.text();
  const lines = text.split("\n").filter(l => l.trim());
  let accounts = [];

  // First extract all UID + Password
  for (const line of lines) {
    try {
      const jsonStr = line.includes("{") ? line.substring(line.indexOf("{")) : line;
      const json = JSON.parse(jsonStr);
      const info = json.guest_account_info;
      if (info) {
        const uid = info["com.garena.msdk.guest_uid"];
        const password = info["com.garena.msdk.guest_password"];
        if (uid && password) accounts.push({ uid, password });
      }
    } catch (e) {}
  }

  if (accounts.length === 0) {
    output2.textContent = "No guest accounts found in file.";
    return;
  }

  output2.textContent += `Found ${accounts.length} accounts. Checking levels (this may take a while)...\n\n`;

  let valid = [];

  for (let i = 0; i < accounts.length; i++) {
    const { uid, password } = accounts[i];
    try {
      const res = await fetch(`https://api.nationcheats.shop/info?uid=${uid}&region=${region}`, { method: "GET" });
      if (res.ok) {
        const data = await res.json();
        const level = data?.basicInfo?.level || 0;
        const nickname = data?.basicInfo?.nickname || "Unknown";

        if (level >= minLevel) {
          valid.push({ uid, password, level, nickname, region });
          output2.textContent += `‚úÖ ${uid} | Level ${level} (${nickname})\n`;
        } else {
          output2.textContent += `‚ùå ${uid} | Level ${level} (below ${minLevel})\n`;
        }
      } else {
        output2.textContent += `‚ö†Ô∏è ${uid} | API Error ${res.status}\n`;
      }
    } catch (err) {
      output2.textContent += `üåê ${uid} | Network/Error\n`;
    }

    // Small delay to avoid getting blocked
    await new Promise(r => setTimeout(r, 600));
  }

  // Final clean JSON result
  const finalJson = JSON.stringify(valid, null, 2);
  output2.textContent += `\n\n=== FINAL RESULT (${valid.length} accounts ‚â• Level ${minLevel}) ===\n\n${finalJson}`;
};
</script>
</body>
</html>
